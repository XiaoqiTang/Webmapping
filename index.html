
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.5">
    <title>Dashboard Template · Bootstrap</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <!--stylesheet imports-->
    <!-- <link rel="stylesheet" href="css/leaflet.css" /> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link href="css/main.css" rel="stylesheet" type="text/css" />
    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      .graph_container{
        display:block;
        width:100%;
      }


      /* dark landing page */
      .overlay{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9998;
        background-color: rgba(0,0,0,0.5); /*dim the background*/
      }
      .landingcontent {
          padding-top:10px;
          width: 100%;
          height: 100%;
          top:0%;
          left:0%;
          position: fixed;
          background-color: white;
          border-radius: 5px;
          text-align: center;
          z-index: 9999; /* 1px higher than the overlay layer */
          overflow: scroll;
      }


    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.js"></script>
  </head>


  <body style="width:100%;height:100%;position:absolute;">
  <div class="overlay"></div>
  <div class="landingcontent">
    <div class="container-fluid" style="position:relative;">
      <div class="row">
        <div class="col-md-12" style="max-width:800px;display:block;margin:0 auto;">
          <h3>What is the Array of Things initiative?</h3>
          <p style="text-align:justify;">As an urban-scale sensing network that collects real-time environmental data in cities, the AoT initiative exemplifies this trend. This is an initiative led by Charlie Catlett and the researchers from the Urban Center for Computation and Data, a joint initiative of the Argonne National Laboratory and the University of Chicago. Launched in 2016 and currently implemented in Chicago, the data collected through this initiative is open and free to the public.</p>
          <h3>What is this application for?</h3>
          <p style="text-align:justify;">Our project seeks to evaluate the level of reliability of the data collected by the AoT network. We provide a method to numerically score daily network data reliability for the network in terms of different data parameters. Based on this score metric, we hope that planners could easily identify segments of the big AoT dataset for their relevant analysis. We also hope the transparent evaluation factors and scores behind this data reliability analysis could promote a more informed use of data in the increasingly data-driven planning process. This application is to be useful in improving research efficiency, considering the increasingly large stores of sensor data available - planners will be able to scope the spatial and temporal scale of their research according to where and when reliable segments of the data is available, instead of having to explore many different datasets to finalise a suitable scope of analysis.</p>
          <h3>How do you use this application?</h3>
          <p style="text-align:left;">This website should be used following the steps:<br>(1) Select a parameter<br>(2) Select a date<br>(*Because of the data collection, please select the date range between December 1st 2018 - December 31st 2018: suggest start from December 15st 2018)<br>(3) Select raw value or imputed value<br>(4) Select apply button<br></p>
          <button id="closeLandingPage" type="button" class="">Let's Start</button>
        </div>
      </div>

    </div>

  </div>
  <script type="text/javascript">
    $("#closeLandingPage").click(function(){
      $(".landingcontent").hide();
      $(".overlay").hide();
    })
  </script>





  <nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Array of Things</a>

    <div class="btn-group" role="group" aria-label="Button group with nested dropdown">

      <div class="btn-group" role="group">
        <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Parameter
          <span class="caret"></span>
        </button>
        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
          <a class="dropdown-item" href="#" data-value="Temperature">Temperature</a>
          <a class="dropdown-item" href="#" data-value="Humidity">Humidity</a>
          <a class="dropdown-item" href="#" data-value="Pressure">Pressure</a>
          <a class="dropdown-item" href="#" data-value="PPM">PPM</a>
          <a class="dropdown-item" href="#" data-value="CO">CO</a>
          <a class="dropdown-item" href="#" data-value="H2S">H2S</a>
          <a class="dropdown-item" href="#" data-value="NO2">NO2</a>
          <a class="dropdown-item" href="#" data-value="O3">O3</a>
          <a class="dropdown-item" href="#" data-value="SO2">SO2</a>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      $(".dropdown-menu a").click(function(){
        console.log(this);
        $("#btnGroupDrop1").html($(this).text() + ' <span class="caret"></span>');
        $("#btnGroupDrop1").val($(this).data('value'));
      });
    </script>


    <input id="datepicker" width="276" />
    <button type="button" class="btn btn-success" id="updateData">Apply</button>


    <div style="width:500px;"></div>
    <ul class="navbar-nav px-3">
      <li class="nav-item text-nowrap">
        <a class="nav-link" href="#"></a>
      </li>
    </ul>
  </nav>



  <div class="container-fluid" style="height:100%;padding-top:40px;">
    <div class="row" style="height:100%;">
      <nav class="col-md-4 bg-light sidebar" style="height:100%;overflow: scroll;">
        <div class="graph_container">
          <h3></h3>
          <div type="button" class="btn btn-secondary mytooltip">Scores of all nodes in one day
            <span class="mytooltiptext">The 5 component scores evaluating the 3 different reliability criteria are averaged to score the Overall Reliability of the AoT network for each day, for each data parameter type. The higher score, the better node behavior</span>
          </div>
          <div class="row">
            <div class="col-md-4">
              <h1 style="display:block;text-align:center;margin-top:50px;"><font size="7" id="score1"></font></h1>
            </div>
            <div class="col-md-8" id="canvascontrol">
              <canvas id="myChart" style="width:100%!important;min-height:200px!important;"></canvas>
            </div>
          </div>

          <hr>
          <div type="button" class="btn btn-secondary mytooltip">Sensor Valure Reliability
            <span class="mytooltiptext">All the data collected should be within sensing range, as determined by the sensor specifications.</span>
          </div>
          <br>
          <p><b class="mytooltip">Network Sensor Value Reliability (A)
            <span class="mytooltiptext">At any given 10-minute time interval in any given node, an average proportion of the data collected by the temperature sensors is reliable.</span>
          </b></p>
          <div style="max-height:40px;max-width:300px;">
            <canvas id="Chart1" style="height:50px !important;width:100% !important;"></canvas>
          </div>
          <p><b class="mytooltip">Overall Consistency in Sensor Value Reliability (B)
            <span class="mytooltiptext">Distribution of node standard deviation scores. The high consistency score here should be interpreted in context with Score A. Here it indicates that the sensor value reliability is consistently bad.</span>
          </b></p>
          <div style="max-height:40px;max-width:300px;">
            <canvas id="Chart2" style="height:50px !important;width:100% !important;"></canvas>
          </div>

          <br>
          <div type="button" class="btn btn-secondary mytooltip">Spatial Reliability
            <span class="mytooltiptext">Reliable data should be collected for the whole spatial extent of Chicago</span>
          </div>

          <p><b class="mytooltip">Average Proportion of Network Active (C)
            <span class="mytooltiptext">Distribution of average proportions of network active at each time interval. At any given 10-minute time interval in any given node, an average proportion of the nodes in the network is collecting reliable data.</span>
          </b></p>
          <div style="max-height:40px;max-width:300px;">
            <canvas id="Chart3" style="height:50px !important;width:100% !important;"></canvas>
          </div>

          <p><b class="mytooltip">Average Proportion of Chicago Area Covered (D)
            <span class="mytooltiptext">At any given 10-minute time interval in any given node, reliable data is collected for an average proportion of Chicago area.</span>
          </b></p>
          <div style="max-height:40px;max-width:300px;">
            <canvas id="Chart4" style="height:50px !important;width:100% !important;"></canvas>
          </div>
          <br>
          <div type="button" class="btn btn-secondary mytooltip">Temporal Reliability
            <span class="mytooltiptext">Reliable data should be collected at consistent time intervals throughout the day.
</span>
          </div>
          <p><b class="mytooltip">Average Proportion of Day-Duration Node is Active (E)
            <span class="mytooltiptext">Distribution of average proportions day-duration for which node is ‘active’. In any given node during the day, reliable data is collected for an average proportion of the time</span>
          </b></p>
          <div style="max-height:40px;max-width:300px;">
            <canvas id="Chart5" style="height:50px !important;width:100% !important;"></canvas>
          </div>




        </div>

      </nav>

      <main role="main" class="col-md-8">
        <div id="map" style="width:100%;height:100%;">
        </div>
      </main>
    </div>
  </div>


  <script>
      var sel_date;
      $('#datepicker').datepicker({
          uiLibrary: 'bootstrap4'
      });
      $("#datepicker").on("change",function(){
          sel_date = $(this).val();
      });
  </script>
  <script src="js/drawchart.js"></script>



  <script src="data/alldata.geojson"></script>
  <script src="data/imputeddata.geojson"></script>
  <!-- <script src="js/leaflet.js"></script> -->
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>

  <script src="data/dayscore.json"></script>
  <script src="data/impudayscore.json"></script>
  <script>
      // Add method to layer control class
      L.Control.Layers.include({
          getActiveOverlays: function () {

              // Create array for holding active layers
              var active = [];

              // Iterate all layers in control
              this._layers.forEach(function (obj) {

                  // Check if it's an overlay and added to the map
                  if (obj.layer._map) {

                      // Push layer to active array
                      active.push(obj.name);
                  }
              });

              // Return array
              return active;
          }
      });



      var beforescore= [];
      var afterscore = [];
      var myLayerControl;




      var map = L.map('map', {
        center: [41.881832, -87.623177],
        zoom: 11
      });
      var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
          '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
          'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

      var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr});
      // streets   = L.tileLayer(mbUrl, {id: 'mapbox.streets', attribution: mbAttr});
      grayscale.addTo(map);

      // ############################### Update Chart function ################################################
      var UpdateChart = function() {
        if (myLayerControl.getActiveOverlays()[0]=="Raw Data"){
          var value0 = beforescore[0];
          var value1 = beforescore[1];
          var value2 = beforescore[2];
          var value3 = beforescore[3];
          var value4 = beforescore[4];
          var value5 = beforescore[5];
        } else {
          var value0 = afterscore[0];
          var value1 = afterscore[1];
          var value2 = afterscore[2];
          var value3 = afterscore[3];
          var value4 = afterscore[4];
          var value5 = afterscore[5];
        }
        $("#score1").html(value0);
        var myChart1 = new Chart(ctx1, {
            type: 'horizontalBar',
            data: {
                labels: [value1],
                datasets: [{
                    data: [value1],
                    backgroundColor: "rgba(63,103,126,1)"
                },{
                    data: [100-value1],
                    backgroundColor: "rgba(192,192,192,1)"
                }]
            },
            options: horizontaloption,
        });
        var myChart2 = new Chart(ctx2, {
            type: 'horizontalBar',
            data: {
                labels: [value2],
                datasets: [{
                    data: [value2],
                    backgroundColor: "rgba(63,103,126,1)"
                },{
                    data: [100-value2],
                    backgroundColor: "rgba(192,192,192,1)"
                }]
            },
            options: horizontaloption,
        });
        var myChart3 = new Chart(ctx3, {
            type: 'horizontalBar',
            data: {
                labels: [value3],

                datasets: [{
                    data: [value3],
                    backgroundColor: "rgba(204,97,127,1)"
                },{
                    data: [100-value3],
                    backgroundColor: "rgba(192,192,192,1)"
                }]
            },

            options: horizontaloption,
        });
        var myChart4 = new Chart(ctx4, {
            type: 'horizontalBar',
            data: {
                labels: [value4],

                datasets: [{
                    data: [value4],
                    backgroundColor: "rgba(204,97,127,1)"
                },{
                    data: [100-value4],
                    backgroundColor: "rgba(192,192,192,1)"
                }]
            },

            options: horizontaloption,
        });
        var myChart5 = new Chart(ctx5, {
            type: 'horizontalBar',
            data: {
                labels: [value5],

                datasets: [{
                    data: [value5],
                    backgroundColor: "rgba(115, 115, 115,1)"
                },{
                    data: [100-value5],
                    backgroundColor: "rgba(192,192,192,1)"
                }]
            },

            options: horizontaloption,
        });
        $("#canvascontrol").html("<canvas id='myChart' style='width:100%!important;min-height:200px!important;'></canvas>");
        new Chart(document.getElementById("myChart"),
          {
            "type":"radar",
            "data":
              {
                "labels":["A","B","C","D","E"],
                "datasets":[
                {
                  "label":"Raw Values",
                  "data":[beforescore[1],beforescore[2],beforescore[3],beforescore[4],beforescore[5]],
                  "fill":true,
                  "backgroundColor":"rgba(255, 99, 132, 0.2)",
                  "borderColor":"rgb(255, 99, 132)",
                  "pointBackgroundColor":"rgb(255, 99, 132)",
                  "pointBorderColor":"#fff",
                  "pointHoverBackgroundColor":"#fff",
                  "pointHoverBorderColor":"rgb(255, 99, 132)"
                },
                {
                  "label":"Imputed Values",
                  "data":[afterscore[1],afterscore[2],afterscore[3],afterscore[4],afterscore[5]],
                  "fill":true,
                  "backgroundColor":"rgba(54, 162, 235, 0.2)",
                  "borderColor":"rgb(54, 162, 235)",
                  "pointBackgroundColor":"rgb(54, 162, 235)",
                  "pointBorderColor":"#fff",
                  "pointHoverBackgroundColor":"#fff",
                  "pointHoverBorderColor":"rgb(54, 162, 235)"
                }]
              },
            "options":{
              // "responsive":false,
              "elements":{"line":{"tension":0,"borderWidth":3}},
              "legend":{
                "position":"bottom"
              },
              "maintainAspectRatio":false
            }
          });
      }
      // ############################### End    Chart function ################################################

      // ################################### update data ######################################################
      $("#updateData").click(function(){
        var parameter = $("#btnGroupDrop1").val();
        var sel_date = $("#datepicker").val();
        var beforeArray = rawtable.filter(function (el) {
          return el.Data == parameter &&
          el.date == sel_date;
        });
        console.log(beforeArray);
        beforescore[0]=parseInt(beforeArray[0].Overall);
        beforescore[1]=parseInt(beforeArray[0]["Score 1"]);
        beforescore[2]=parseInt(beforeArray[0]["Score 2"]);
        beforescore[3]=parseInt(beforeArray[0]["Score 3"]);
        beforescore[4]=parseInt(beforeArray[0]["Score 4"]);
        beforescore[5]=parseInt(beforeArray[0]["Score 5"]);
        var afterArray = imputedtable.filter(function (el) {
          return el.Data == parameter &&
          el.date == sel_date;
        });
        console.log(beforeArray);
        afterscore[0]=parseInt(afterArray[0].Overall);
        afterscore[1]=parseInt(afterArray[0]["Score 1"]);
        afterscore[2]=parseInt(afterArray[0]["Score 2"]);
        afterscore[3]=parseInt(afterArray[0]["Score 3"]);
        afterscore[4]=parseInt(afterArray[0]["Score 4"]);
        afterscore[5]=parseInt(afterArray[0]["Score 5"]);
        UpdateChart();
      })
      // ################################### End update  ######################################################




      var addMarkers = function(map) {
        var invalidnode = L.icon({
            iconUrl: 'images/allnodes.svg',
            iconSize: [9, 9],

        });
        var rawnode = L.icon({
            iconUrl: 'images/rawdata.svg',
            iconSize: [9, 9],

        });
        var imputednode = L.icon({
            iconUrl: 'images/imputeddata.svg',
            iconSize: [9, 9],

        });
        var rawdatalist = [];
        var imputeddatalist = [];
        for (i = 0; i < rawdata.length; i++) {
            if (rawdata[i].info!="This is invalid node") {
              var marker = L.marker([rawdata[i].lat,rawdata[i].lon],{icon: rawnode})
            } else {
              var marker = L.marker([rawdata[i].lat,rawdata[i].lon],{icon: invalidnode})
            }
            marker.bindPopup("<b>"+rawdata[i].info+"</b>");
            rawdatalist.push(marker);
        }
        for (i = 0; i < imputeddata.length; i++) {
            if (imputeddata[i].info!="This is invalid node") {
              var marker = L.marker([imputeddata[i].lat,imputeddata[i].lon],{icon: imputednode})
            } else {
              var marker = L.marker([imputeddata[i].lat,imputeddata[i].lon],{icon: invalidnode})
            }
            marker.bindPopup("<b>"+imputeddata[i].info+"</b>");
            imputeddatalist.push(marker);
        }
        var group1 = L.layerGroup(rawdatalist);
        var group2 = L.layerGroup(imputeddatalist);
        var overlayMaps = {
            "Raw Data": group1,
            "Imputed Data": group2
        };
        myLayerControl = L.control.layers(overlayMaps);
        myLayerControl.addTo(map);
        group1.addTo(map);

        $("[name='leaflet-base-layers']").change( function () {
          if (beforescore[0]) {
            UpdateChart();
          }
        });
      }
      addMarkers(map);

  </script>



</html>
